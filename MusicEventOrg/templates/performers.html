{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1
        style="font-size: 2.5rem; font-weight: 700; margin-bottom: 2rem; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; text-align: center;">
        Performers</h1>

    <div class="row" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem;">
        {% for performer in performers %}
        <div class="card" style="height: 100%; display: flex; flex-direction: column;">
            {% if performer.image %}
            <img src="{{ performer.image.url }}" alt="{{ performer.name }}"
                style="width: 100%; height: 250px; object-fit: cover;">
            {% else %}
            <div
                style="height: 250px; background: var(--surface-dark); display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                No Image Available
            </div>
            {% endif %}
            <div class="card-body" style="flex: 1; display: flex; flex-direction: column;">
                <h5 class="card-title">{{ performer.name }}</h5>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; flex: 1;">{{ performer.bio|truncatewords:20 }}</p>

                <div style="margin-top: auto;">
                    {% if user.is_authenticated %}
                    <button type="button" class="btn btn-primary w-100"
                        onclick="openBookingModal('{{ performer.id }}', '{{ performer.name }}')">
                        Book Performer
                    </button>
                    {% else %}
                    <a href="{% url 'login' %}?next={% url 'performers' %}" class="btn btn-primary w-100">
                        Login to Book
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p style="color: var(--text-secondary); font-size: 1.2rem;">No performers available.</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Booking Modal -->
<div id="bookingModal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
    <div class="card" style="width: 90%; max-width: 500px; position: relative;">
        <div class="card-body">
            <h3 class="card-title" id="modalTitle">Book Performer</h3>
            <form id="bookingForm" method="post" action="">
                {% csrf_token %}
                <div class="form-group">
                    <label for="eventSelect"
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Select
                        Event</label>
                    <select name="event_id" id="eventSelect" required
                        style="width: 100%; padding: 0.75rem 1rem; background: var(--surface-dark); border: 1px solid var(--glass-border); border-radius: var(--radius-md); color: var(--text-primary); font-size: 1rem;">
                        <option value="">-- Select an Event --</option>
                        {% for event in events %}
                        <option value="{{ event.id }}">{{ event.title }} ({{ event.date|date:"M d, Y" }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Confirm Booking</button>
                    <button type="button" class="btn"
                        style="flex: 1; background: var(--surface-dark); color: var(--text-secondary);"
                        onclick="closeBookingModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function openBookingModal(performerId, performerName) {
        const modal = document.getElementById('bookingModal');
        const form = document.getElementById('bookingForm');
        const title = document.getElementById('modalTitle');

        // Set form action dynamically
        form.action = `/performers/book/${performerId}/`;
        title.textContent = `Book ${performerName}`;

        modal.style.display = 'flex';
    }

    function closeBookingModal() {
        document.getElementById('bookingModal').style.display = 'none';
    }

    // Close modal if clicking outside
    window.onclick = function (event) {
        const modal = document.getElementById('bookingModal');
        if (event.target == modal) {
            closeBookingModal();
        }
    }
</script>
{% endblock %}
